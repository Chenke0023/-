# 🕐 定时任务已配置

## ✅ 安装状态

**Cron 任务**: ✅ 已成功安装
**运行时间**: 每天早上 09:00
**日志目录**: `/Users/a1-6/Downloads/新闻抓取脚本/logs/`

---

## 📋 Cron 配置

当前已安装的 cron 任务：
```cron
0 9 * * * cd "/Users/a1-6/Downloads/新闻抓取脚本" && ./run_daily.sh
```

**含义**:
- `0 9` = 每天第 0 分钟（即整点）第 9 小时
- `* * *` = 每月、每周、每天

---

## 📁 项目文件结构

```
/Users/a1-6/Downloads/新闻抓取脚本/
├── run_daily.sh              ← 主运行脚本（由 cron 调用）
├── batch_process.py          ← 批量处理核心脚本
├── crontab.txt             ← Cron 配置文件
├── install_cron.sh          ← 安装脚本（已完成）
├── ai-rss-filter/
│   └── data/rss_data.db    ← RSS 数据库（675 条新闻）
├── logs/                   ← 运行日志目录（自动创建）
│   └── cron_run_YYYYMMDD_HHMMSS.log
└── README_使用说明.md       ← 完整使用文档
```

---

## 🔧 管理 Cron 任务

### 查看当前 cron 任务
```bash
crontab -l
```

### 编辑 cron 任务
```bash
crontab -e
```

### 删除 cron 任务
```bash
crontab -r
```

### 重新安装 cron 任务
```bash
./install_cron.sh
```

---

## 📊 每日自动流程

**每天早上 9:00 自动执行**：

1. ✅ 运行 `run_daily.sh` 包装脚本
2. ✅ 调用 `batch_process.py` 处理新闻
3. ✅ 从数据库读取所有新闻（675+ 条）
4. ✅ 批量调用 LLM 判断相关性（每批 50 条）
5. ✅ 生成完整 Markdown 报告
6. ✅ 生成 JSON 数据文件
7. ✅ 记录运行日志到 `logs/` 目录
8. ✅ 自动清理 30 天前的旧日志

**预期运行时间**: 约 10-15 分钟（取决于数据库新闻数量）

---

## 📄 输出文件

**每天早上 9:00 后会生成**：

```
相关新闻_YYYYMMDD_HHMMSS.md     ← 完整的 Markdown 报告
filtered_news_YYYYMMDD_HHMMSS.json ← 完整的 JSON 数据
logs/cron_run_YYYYMMDD_HHMMSS.log ← 运行日志
```

---

## ⚙️ Mac 系统设置

### 确保后台任务允许运行

**系统偏好设置** → **节能** → **电源适配器**：

- ✅ 勾选 "防止计算机在显示器关闭时自动睡眠"
- ✅ 勾选 "当使用电源适配器时防止计算机睡眠"

或者使用命令行（推荐）：
```bash
sudo pmset -a disablesleep 1
```

### 取消系统睡眠（如需）
```bash
# 取消睡眠
sudo pmset -a disablesleep 1

# 恢复默认睡眠设置
sudo pmset -a disablesleep 0
```

---

## 🧪 测试定时任务

### 手动运行一次（测试）
```bash
cd /Users/a1-6/Downloads/新闻抓取脚本
./run_daily.sh
```

### 查看下次运行时间
```bash
# Mac 系统日志
log show --predicate 'eventMessage contains "cron"' --last 1h
```

---

## 📋 过滤主题

当前配置的主题：
1. **Social networking**（社交网络）
2. **Live streaming**（直播）
3. **TMT acquisitions**（TMT并购）
4. **Mobile gaming**（手机游戏）

---

## 🔍 日志查看

### 查看最近运行日志
```bash
# 查看最新日志
ls -lt /Users/a1-6/Downloads/新闻抓取脚本/logs/ | head

# 查看日志内容
cat /Users/a1-6/Downloads/新闻抓取脚本/logs/cron_run_*.log
```

### 实时监控运行状态（如果脚本正在运行）
```bash
# 查看当前批处理日志
tail -f /tmp/batch_process_new.log
```

---

## ⚠️ 重要提醒

1. **电脑必须在早上 9 点开机**
   - 如果电脑关机，cron 任务不会执行
   - 建议保持电脑开机，或使用云服务器

2. **API 速率限制**
   - 如果遇到 429 错误，脚本会自动重试（最多 3 次）
   - 每批处理间隔 10 秒

3. **日志会自动清理**
   - 只保留最近 30 天的日志
   - 超过 30 天的日志会自动删除

4. **Docker 服务需要运行**
   - RSS 抓取由 Docker 容器持续运行
   - 确保容器正常运行：`docker ps | grep ai-rss-filter`

---

## 🚀 快速操作

```bash
# 进入项目目录
cd /Users/a1-6/Downloads/新闻抓取脚本

# 查看当前 cron 配置
crontab -l

# 编辑 cron 配置
crontab -e

# 查看日志
ls -lt logs/ | head

# 测试运行
./run_daily.sh

# 监控运行状态
python3 monitor.py
```

---

## 📞 常见问题

### Q: 如何修改运行时间？
A: 使用 `crontab -e` 编辑，将 `0 9` 改为其他时间，例如：
   - `0 8 * * *` → 每天 08:00
   - `30 9 * * *` → 每天 09:30

### Q: 如何禁用自动运行？
A: 使用 `crontab -e` 删除对应行，或直接运行 `crontab -r` 删除所有 cron 任务

### Q: 如何临时运行一次？
A: 直接运行 `./run_daily.sh`

### Q: 如果早上 9 点电脑关机会怎样？
A: 任务不会执行。建议：
   - 保持电脑开机
   - 或改到电脑开机的时间运行
   - 或使用云服务器托管

---

*配置完成！系统会在每天早上 9 点自动处理 RSS 新闻并生成报告。*
