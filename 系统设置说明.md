# 🌅 电脑自动唤醒和运行设置

## ✅ 已完成的设置

1. ✅ **Cron 定时任务**: 每天 09:00 运行
2. ✅ **系统唤醒任务**: 每天 08:50 唤醒电脑
3. ✅ **唤醒任务已加载**: launchctl 确认已加载

---

## 📋 每日执行流程

```
08:50  ← 系统自动唤醒电脑（launchd 任务）
   ↓
09:00  ← 运行 RSS 过滤脚本（cron 任务）
   ↓
处理 10-15 分钟  ← 批量处理 675+ 条新闻
   ↓
生成报告  ← 创建 Markdown 和 JSON 文件
```

---

## ⚙️ 必要的电脑设置

### 方法一：防止睡眠（推荐）

```bash
sudo pmset -a disablesleep 1
```

**或使用系统偏好设置**：

**macOS Ventura/Sonoma/Sequoia**:
1. 打开 **系统设置** → **锁定屏幕**
2. 取消勾选 "当显示器关闭时，防止自动睡眠"

**macOS Monterey 及更早版本**:
1. 打开 **系统偏好设置** → **节能**
2. 设置 "关闭显示器" 为 **从不**
3. 取消勾选 "防止计算机在显示器关闭时自动睡眠"

### 方法二：确保显示器不关闭

**系统偏好设置** → **节能**：
- ✅ "关闭显示器后防止计算机自动睡眠" → 取消勾选

### 方法三：保持电源连接

- 🔌 建议连接电源适配器
- ⚠️ 避免电池耗尽导致关机

---

## 🔍 验证设置

### 检查 Cron 任务
```bash
crontab -l
```

**应该看到**:
```
0 9 * * * cd "/Users/a1-6/Downloads/新闻抓取脚本" && ./run_daily.sh
```

### 检查唤醒任务
```bash
launchctl list | grep com.rssfilter.wakeup
```

**应该看到**:
```
-	0	com.rssfilter.wakeup
```

### 检查 Docker 服务
```bash
docker ps | grep ai-rss-filter
```

**应该看到**:
```
CONTAINER ID   IMAGE                          NAMES
...           zuco1111/ai-rss-filter:arm64   ai-rss-filter
```

---

## 🔧 修改设置

### 修改 Cron 运行时间

```bash
# 编辑 cron 任务
crontab -e

# 将 `0 9 * * *` 修改为其他时间，例如：
# 0 8 * * *    → 每天 08:00
# 30 9 * * *   → 每天 09:30
# 0 */4 * * *  → 每 4 小时一次
```

### 修改唤醒时间

```bash
# 编辑 plist 文件
nano ~/Library/LaunchAgents/com.rssfilter.wakeup.plist

# 修改这行为希望的时间（24 小时制）:
# <string>08:50:00</string>  ← 改为其他时间，如 08:45:00

# 保存后重新加载
launchctl bootout system com.rssfilter.wakeup
launchctl load ~/Library/LaunchAgents/com.rssfilter.wakeup.plist
```

### 卸载唤醒任务（如需要）

```bash
launchctl bootout system com.rssfilter.wakeup
launchctl bootout gui/$(id -u)/com.rssfilter.wakeup
```

### 恢复系统默认睡眠设置

```bash
sudo pmset -a disablesleep 0
```

---

## 📊 测试自动任务

### 手动测试 Cron 任务
```bash
# 立即运行一次
cd /Users/a1-6/Downloads/新闻抓取脚本
./run_daily.sh
```

### 测试唤醒功能
```bash
# 设置 2 分钟后唤醒测试
sudo pmset relative wake "now+2m"
```

---

## ⚠️ 重要注意事项

### 1. 电脑必须保持开机

- ❌ **不能完全关机**：如果关机，唤醒任务无法执行
- ✅ **建议状态**：睡眠或屏幕锁定状态
- 💡 **最佳实践**：连接电源，保持睡眠状态即可

### 2. 确保电源供应

- 🔌 **推荐**：连接电源适配器
- 🔋 **不推荐**：仅使用电池（可能耗尽）

### 3. macOS 版本差异

不同版本的 macOS 菜单路径可能不同：
- **Sonoma/Sequoia**: 系统设置 → 锁定屏幕
- **Ventura**: 系统偏好设置 → 锁定屏幕
- **Monterey 及更早**: 系统偏好设置 → 节能

---

## 🗑️ 完全卸载所有任务

### 删除 Cron 任务
```bash
crontab -r
```

### 删除唤醒任务
```bash
launchctl bootout system com.rssfilter.wakeup
launchctl bootout gui/$(id -u)/com.rssfilter.wakeup
rm ~/Library/LaunchAgents/com.rssfilter.wakeup.plist
```

---

## 📅 时间线总结

| 时间 | 事件 |
|------|------|
| 08:50 | 系统唤醒电脑（launchd 任务）|
| 09:00 | Cron 任务启动运行 RSS 过滤 |
| 09:00-09:15 | 批量处理新闻（675+ 条）|
| 09:15 | 生成 Markdown 报告和 JSON 文件 |
| 之后 | 查看报告（相关新闻_*.md）|

---

## 💡 常见问题

### Q: 明天早上会自动运行吗？
A: **是的**，前提是：
   - ✅ 电脑处于开机状态（睡眠或关屏都可以）
   - ✅ 系统设置为不自动睡眠
   - ✅ Cron 任务和唤醒任务都已安装

### Q: 如果电脑完全关机会怎样？
A: 任务无法执行。建议：
   - 保持电脑开机
   - 或在晚上设置为睡眠而非关机

### Q: 如何临时禁用自动运行？
A:
```bash
# 卸载唤醒任务
launchctl bootout system com.rssfilter.wakeup

# 删除 cron 任务
crontab -r
```

### Q: 如何查看明天是否成功运行？
A:
```bash
# 查看日志
ls -lt /Users/a1-6/Downloads/新闻抓取脚本/logs/

# 查看输出文件
ls -lt /Users/a1-6/Downloads/新闻抓取脚本/相关新闻_*.md
```

### Q: 可以修改为每天多次运行吗？
A: 可以，编辑 cron 任务：
```bash
crontab -e

# 例如：每天 8 点和 9 点运行两次
0 8 * * * cd "/Users/a1-6/Downloads/新闻抓取脚本" && ./run_daily.sh
0 9 * * * cd "/Users/a1-6/Downloads/新闻抓取脚本" && ./run_daily.sh
```

---

## ✅ 完成检查清单

在使用前请确认：

- [ ] 电脑已连接电源
- [ ] 系统设置为不自动睡眠（pmset -a disablesleep 1）
- [ ] Cron 任务已安装（运行 `crontab -l` 检查）
- [ ] 唤醒任务已加载（运行 `launchctl list | grep rssfilter` 检查）
- [ ] Docker 服务运行中（运行 `docker ps | grep ai-rss-filter` 检查）
- [ ] 电脑处于开机状态（不是完全关机）

**全部勾选后，明天早上 9 点会自动运行！**

---

*设置完成后，明天早上 8:50 电脑会自动唤醒，9:00 开始处理 RSS 新闻。*
